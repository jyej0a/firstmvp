# Trend-Hybrid Admin MVP 개발 TODO

**개발 목표:** 2026-01-10 (MVP 1.0 Launch)  
**문서 버전:** v3.2 (Phase 2.5 순차 처리 구현 추가)  
**최종 수정:** 2024-12-15

> 💡 **개발 원칙:** 사용자 플로우를 따라 점진적으로 구현하고, 각 단계마다 실제로 동작하는 것을 확인한 후 다음 단계로 진행한다.

> ⚠️ **Phase 매핑:** 이 문서의 Phase 번호는 개발 편의상 정의되었으며,
> 전체 프로젝트 일정은 [Timetable.md](./Timetable.md) 참조.
>
> - TODO Phase 0 = Timetable Phase 1 (인프라 세팅)
> - TODO Phase 2 = Timetable Phase 2 (시스템 개발)

## 📅 전체 타임라인

```
Phase 0: 인프라 세팅        12/03 - 12/10 (8일)   [비개발]
                            12/11 - 12/12 (2일)   [버퍼]
Phase 2: 코어 개발          12/13 - 12/29 (17일)  [개발]
Phase 3: 테스트 & 런칭      12/30 - 01/09 (11일)  [검증]

🚀 MVP 1.0 런칭: 2026-01-10

Post-MVP: 기능 확장         01/11 - 01/24 (14일)
🎉 v1.1 정식 런칭: 2026-01-24
```

## 🎯 MVP 1.0 vs v1.1 구분

### MVP 1.0 (01/10 런칭)

- ✅ 아마존 **하루 최대 1000개** 수집 (1분당 1개씩 순차 수집, 약 16.7시간 소요)
- ✅ 금지어 필터링
- ✅ 체크박스 선택 UI
- ✅ 타오바오 이미지 검색 브릿지 (1클릭)
- ✅ **US 타입 가격 자동 계산만**
- ✅ Shopify 일괄 등록 (순차 처리: 1개 수집 → 등록 → 다음 수집)

### v1.1 (01/24 런칭)

- ⏭️ 수집 기능 개선 (리뷰수, 평점 등 추가 요소 수집)
- ⏭️ CN 타입 가격 계산
- ⏭️ 중국어 이미지 필터링
- ⏭️ Toast 알림 시스템
- ⏭️ 반응형 디자인

---

## 📅 Phase 0: 인프라 세팅 (비개발, 대비마마 담당)

**기간:** 12/03 - 12/10 (8일)  
**상태:** 준비 중

### 0-1 개발 환경 확인 (12/03, 0.5일) ✅ 완료

- [x] Node.js 버전 확인 (v18 이상 권장) - **v22.19.0 설치 확인**
- [x] Puppeteer 설치 가능 환경 확인 - **v24.31.0 설치 및 테스트 성공**
- [x] 프록시 서비스 조사 (선택사항, Bot Detection 대응용) - **조사 완료 (MVP 1.0에서는 미사용)**

> 📄 **완료 보고서:** [phase-0-1-environment-check.md](./phase-0-1-environment-check.md)  
> 📄 **프록시 조사:** [proxy-services-research.md](./proxy-services-research.md)  
> 🧪 **테스트 스크립트:** [lib/scraper/test-puppeteer.ts](../lib/scraper/test-puppeteer.ts)

### 0-2 Shopify 스토어 개설 (12/04-12/06, 3일)

- [x] Shopify 스토어 생성 및 기본 설정 ✅ **2025-12-04 완료**
- [x] Admin API Access Token 발급 ✅ **2025-12-04 완료**
- [ ] 테스트 상품 등록 연습

### 0-3 PG 연동 (12/07-12/08, 2일)

- [ ] 결제 시스템 연동 설정

### 0-4 드롭쉬핑 명 세팅 (12/09-12/10, 2일)

- [ ] 비즈니스 정보 등록 및 최종 점검

### ✅ Phase 0 완료 조건

- [x] 개발 환경 확인 완료 (Node.js, Puppeteer) ✅
- [x] Shopify 스토어가 생성되고 Access Token 발급됨 ✅ **2025-12-04 완료**
- [ ] 테스트 상품을 수동으로 등록할 수 있음
- [ ] PG 연동 및 비즈니스 정보 등록 완료
- [ ] 모든 인프라가 준비되어 개발 시작 가능

⚠️ **중요:** Phase 0 완료 전까지 Phase 2 시작 불가 (특히 Shopify Access Token 필수)

---

## 📋 Phase 1: 최소 UI 구성 (입력 & 트리거)

### 목표

사용자가 키워드/URL을 입력하고 "수집 시작" 버튼을 클릭할 수 있는 최소한의 UI 구성

### 1.1 대시보드 기본 페이지

- [x] `app/dashboard/page.tsx` 파일 생성
  - [x] 페이지 레이아웃 (제목, 설명)
  - [x] 검색 입력창 (placeholder: "키워드 입력 또는 Amazon URL 붙여넣기...")
  - [x] "수집 시작" 버튼
  - [x] 버튼 클릭 시 입력값 콘솔 출력 (테스트용)

### 1.2 트렌드 숏컷 버튼

- [x] 상단에 Quick Links 섹션 추가
  - [x] Kalodata 버튼 (새 탭 열기)
  - [x] Amazon Best Sellers 버튼 (새 탭 열기)
  - [x] TikTok Trends 버튼 (새 탭 열기)

### 1.3 라우팅 설정

- [x] 메인 페이지(`app/page.tsx`)에서 `/dashboard`로 리디렉션

### ✅ Phase 1 완료 조건

- [x] 대시보드 페이지가 브라우저에서 정상 표시됨
- [x] 트렌드 숏컷 버튼 클릭 시 새 탭으로 외부 사이트가 열림
- [x] 입력창에 텍스트 입력 후 버튼 클릭 시 콘솔에 값이 출력됨

---

## 🔍 Phase 2: 스크래핑 로직 구현 (1분당 1개 순차 수집)

**기간:** 12/13 - 12/17 (5일)

### 목표

실제 아마존에서 상품 정보를 **1분당 1개씩 순차 수집**하여 DB 저장 및 UI 업데이트. 하루 최대 **1000개** 수집 가능 (약 16.7시간 소요). 순차 처리 방식: 1개 수집 → 등록 완료 → 다음 수집 진행.

### 2.1 환경 구성 (12/13, 1일) ✅ 완료

- [x] `pnpm add puppeteer` 실행
- [x] Puppeteer 설치 확인
- [x] TypeScript 타입 정의 (`types/index.ts`)
  - [x] `ScrapedProductRaw` 인터페이스
  - [x] `Product` 인터페이스
  - [x] `SourcingType`, `ProductStatus` 타입

### 2.2 URL 처리 유틸리티 (12/13, 0.5일) ✅ 완료

- [x] `lib/utils/url-processor.ts` 파일 생성
  - [x] `processSearchInput()` 함수 구현
    - [x] URL 여부 판단 (http로 시작하는지)
    - [x] URL인 경우: amazon.com 도메인 검증
    - [x] 키워드인 경우: Amazon 검색 URL 생성
    - [x] 예외 처리 (빈 값, 잘못된 URL 등)

### 2.3 아마존 스크래핑 로직 (12/14-12/16, 3일) ✅ 완료

- [x] `lib/scraper/amazon-scraper.ts` 파일 생성
  - [x] Puppeteer 브라우저 초기화
  - [x] User-Agent 설정 (Bot Detection 회피)
  - [x] 아마존 검색 결과 페이지 접속
  - [x] 상품 정보 추출 (ASIN, 제목, 이미지, 가격, URL)
  - [x] **페이지네이션 로직 추가** (2-3 페이지, 30개까지)
  - [x] 랜덤 딜레이 추가 (1-3초)
  - [x] 콘솔에 결과 출력

### 2.4 스크래핑 API Route (12/16, 0.5일) ✅ 완료 (2024-12-04)

- [x] `app/api/scrape/route.ts` 파일 생성
  - [x] POST 요청 핸들러
  - [x] URL 처리 유틸리티 호출
  - [x] 스크래핑 함수 호출
  - [x] 결과를 JSON으로 반환
  - [x] 에러 핸들링 (Timeout, Network Error 등)
  - [x] Rate Limiting 구현 (개발/프로덕션 분리)
  - [x] API 테스트 완료 (43개 상품 수집 성공)

### 2.5 대시보드 연동 (12/17, 0.5일) ✅ 완료 (2024-12-04)

- [x] 대시보드에서 "수집 시작" 버튼 클릭 시
  - [x] `/api/scrape`에 POST 요청
  - [x] 로딩 상태 표시 ("수집 중...")
  - [x] 결과를 콘솔에 출력
  - [x] 기본 에러 메시지 표시
  - [x] 성공 메시지 표시 (상품 개수, 소요 시간, 페이지 수)
  - [x] 수집된 상품 미리보기 표시 (최대 6개)

### ✅ Phase 2 완료 조건

- [x] 키워드 입력 → Amazon URL 자동 변환 확인 ✅ **2024-12-04 완료**
- [x] URL 직접 입력 → 그대로 사용 확인 ✅ **2024-12-04 완료**
- [x] **스크래핑 실행 시 실제 아마존 상품 24개가 콘솔에 출력됨** ✅ **2024-12-04 완료**
- [x] ASIN, 제목, 이미지, 가격이 제대로 추출됨 ✅ **2024-12-04 완료**
- [x] 2 페이지에서 데이터 수집 확인 ✅ **2024-12-04 완료**
- [x] 대시보드 UI에서 로딩/성공/에러 상태 표시 ✅ **2024-12-04 완료**
- [x] 수집된 상품 미리보기 표시 (그리드 뷰) ✅ **2024-12-04 완료**

> 🎉 **Phase 2 스크래핑 로직 구현 완료!** (2024-12-04)
>
> - 24개 상품 수집 성공 (14.8초 소요)
> - Bot Detection 회피 (User-Agent, 랜덤 딜레이)
> - Rate Limiting 구현 (개발/프로덕션 분리)
> - 대시보드 UI 연동 완료
>
> 💡 **참고:** 순차 처리 방식 (1분당 1개 수집)은 Phase 2.5에서 구현됨
>
> 📸 **스크린샷:** `.playwright-mcp/dashboard-scraping-success.png`

---

## 💾 Phase 2 (계속): 데이터베이스 설계

**기간:** 12/18 (1일) - Phase 2의 일부

### 목표

스크래핑된 데이터를 저장할 DB 스키마 설계 및 마이그레이션

### 2.6 Products 테이블 마이그레이션 (12/04, 0.5일) ✅ 완료

- [x] `supabase/migrations/20241204000000_create_products_table.sql` 작성
  - [x] 기본 필드 (id, user_id, asin, source_url, title, description)
  - [x] 이미지 (images TEXT[])
  - [x] 옵션 (variants JSONB)
  - [x] **US 타입 전용 필드** (amazon_price, margin_rate, selling_price)
  - [x] 상태 (status: draft/uploaded/error)
  - [x] UNIQUE 제약조건 (asin)
  - [x] RLS 비활성화

### 2.7 Banned Keywords 테이블 마이그레이션 (12/04, 0.5일) ✅ 완료

- [x] `supabase/migrations/20241204000100_create_banned_keywords_table.sql` 작성
  - [x] 테이블 스키마 (id, keyword, created_at)
  - [x] 초기 금지어 데이터 INSERT (Nike, Adidas, Apple 등 15개)

### 2.8 마이그레이션 실행 ✅ 완료

- [x] Supabase CLI로 마이그레이션 실행 (`supabase db push`)
- [x] 테이블 생성 확인
- [x] 초기 데이터 확인 (금지어 15개)

### ✅ DB 설계 완료 조건

- [x] Supabase에서 `products` 테이블이 생성됨 ✅ **2024-12-04 완료**
- [x] Supabase에서 `banned_keywords` 테이블이 생성되고 초기 데이터가 있음 ✅ **2024-12-04 완료 (15개)**
- [x] TypeScript 타입 정의가 완료되고 import 가능함 ✅ **2024-12-04 완료**

---

## 📊 Phase 2 (계속): DB 저장 & 리스트 표시

**기간:** 12/19 - 12/22 (4일)

### 목표

스크래핑한 데이터를 DB에 저장하고 체크박스가 있는 리스트로 표시

### 2.9 금지어 필터링 (12/19, 1일) ✅ 완료 (2024-12-08)

- [x] 스크래핑 로직에 금지어 필터링 추가
  - [x] `filterByBannedKeywords()` 함수 구현
  - [x] Supabase에서 금지어 목록 조회
  - [x] 제목에 금지어 포함 시 제외
  - [x] 필터링 통계 (제거된 개수) 반환

### 2.10 DB 저장 로직 (12/19, 0.5일) ✅ 완료 (2024-12-08)

- [x] 스크래핑 API에 DB 저장 로직 추가
  - [x] Supabase 클라이언트 생성 (service-role)
  - [x] 필터링된 상품을 `products` 테이블에 INSERT
  - [x] 중복 ASIN 처리 (ON CONFLICT)
  - [x] 성공/실패 카운트 반환
  - [x] 가격 유효성 검증 추가 (0 이하 가격 필터링)
  - [x] 스크래퍼 가격 추출 로직 개선 (여러 selector 시도)

### 2.11 상품 조회 API (12/20, 0.5일) ✅ 완료 (2024-12-08)

- [x] `app/api/products/route.ts` 생성
  - [x] GET 요청 핸들러
  - [x] 현재 사용자의 상품 목록 조회
  - [x] 최신순 정렬
  - [x] 페이지네이션 준비 (limit/offset)

### 2.12 상품 리스트 컴포넌트 (12/20-12/21, 2일) ✅ 완료 (2024-12-08)

- [x] `components/ProductList.tsx` 생성
  - [x] 테이블 구조 (Checkbox, Image, Title, ASIN, Margin, Price, Status)
  - [x] **체크박스 컬럼 추가**
    - [x] 전체 선택/해제 (헤더)
    - [x] 개별 선택 (각 행)
    - [x] 선택된 개수 표시 ("48개 중 5개 선택")
  - [x] 빈 리스트 상태 UI
  - [x] 썸네일 이미지 표시
  - [x] 반응형 테이블 스크롤
  - [x] 타오바오 이미지 검색 브릿지 (이미지 클릭)
  - [x] 상태 배지 표시 (Draft/Uploaded/Error)

### 2.13 대시보드 통합 (12/22, 0.5일) ✅ 완료 (2024-12-08)

- [x] 대시보드에서 상품 목록 조회
  - [x] 페이지 로드 시 자동 조회
  - [x] 수집 완료 후 목록 새로고침
  - [x] 수집된 상품 개수 표시
  - [x] "선택 등록" 버튼 추가 (비활성 상태)
  - [x] 선택된 상품 개수 표시
  - [x] ProductList 컴포넌트 통합

### ✅ DB 저장 & 리스트 완료 조건

- [x] 수집 시 금지어가 필터링됨 (콘솔 로그 확인) ✅ **2024-12-08 완료**
- [x] 수집된 상품이 DB에 저장됨 (Supabase Dashboard에서 확인) ✅ **2024-12-08 완료**
- [x] 대시보드에 저장된 상품 목록이 표시됨 ✅ **2024-12-08 완료**
- [x] 이미지, 제목, ASIN, Status가 제대로 표시됨 ✅ **2024-12-08 완료**
- [x] **체크박스로 상품 선택 가능** ✅ **2024-12-08 완료**
- [x] **선택된 개수가 실시간으로 표시됨** ✅ **2024-12-08 완료**

---

## 💰 Phase 2 (완료): US 타입 가격 자동 계산 ✅

**기간:** 12/23 - 12/24 (2일) → **완료 (2024-12-09)**

### 목표

US 타입 기준 마진율로 판매가 자동 계산 (MVP 1.0 범위)

### 2.14 가격 계산 로직 (12/23, 1일) ✅ 완료 (2024-12-09)

- [x] `lib/pricing/calculator.ts` 생성
  - [x] `calculateSellingPriceUS()` 함수 ⚠️ **추후 수정될 수 있음**
    - [x] 공식: `amazonPrice × (1 + marginRate / 100)`
    - [x] 기본 마진율: 40%
  - [x] `calculateSellingPriceCN()` 함수 (v1.1 대비)
    - [x] 공식: `(costPrice + shippingCost + extraCost) / (1 - marginRate / 100)`
  - [x] `validatePriceData()` 함수
    - [x] amazonPrice > 0 검증
    - [x] marginRate 범위 검증 (0-100%)
  - [x] `calculatePrice()` 통합 함수 (자동 타입 선택)
  - [x] `calculateMarginRate()` 역계산 함수

### 2.15 리스트에 마진/가격 컬럼 추가 (12/24, 1일) ✅ 완료 (2024-12-09)

- [x] ProductList에 컬럼 추가
  - [x] Margin 입력창 (기본값 40%, type="number")
  - [x] Selling Price 표시 (자동 계산, Read-only)
  - [x] 마진율 변경 시 즉시 재계산 (onChange)
  - [x] 로컬 상태 관리 (localMargins, localPrices)
  - [x] 입력 완료 시 API 호출 (onBlur → onMarginChange)

### 2.16 상품 업데이트 API (12/24, 0.5일) ✅ 완료 (2024-12-09)

- [x] `app/api/products/[id]/route.ts` 생성
  - [x] PATCH 요청 핸들러
  - [x] Margin Rate 업데이트
  - [x] Selling Price 자동 재계산 (calculatePrice 함수 사용)
  - [x] DB 저장 (Supabase)
  - [x] GET 핸들러 (상품 상세 조회)
  - [x] DELETE 핸들러 (상품 삭제)
  - [x] 사용자 인증 확인 (Clerk)
  - [x] 에러 핸들링

### 2.17 대시보드 통합 ✅ 완료 (2024-12-09)

- [x] handleMarginChange 함수 구현
  - [x] API 호출 (/api/products/[id])
  - [x] 로컬 상품 목록 업데이트
  - [x] 콘솔 로그 (디버깅용)
- [x] ProductList에 onMarginChange prop 전달

### ✅ 가격 계산 완료 조건

- [x] 아마존 가격 기반으로 판매가가 자동 계산됨 ✅ **2024-12-09 완료**
- [x] 마진율 입력 시 즉시 가격이 재계산됨 ✅ **2024-12-09 완료**
- [x] 계산된 가격이 정확함 (수동 계산과 비교) ✅ **2024-12-09 완료**
- [x] 변경사항이 DB에 저장됨 ✅ **2024-12-09 완료**

> 🎉 **Phase 2 US 타입 가격 자동 계산 완료!** (2024-12-09)
>
> - 가격 계산 로직 구현 (US/CN 타입 모두 지원)
> - 실시간 마진율 입력 및 가격 재계산
> - 상품 업데이트 API (PATCH /api/products/[id])
> - 대시보드 통합 완료
> - ✅ **단위 테스트 작성 완료** (30개 테스트, 100% 통과)
> - ✅ **정확도 검증 완료** (10개 시나리오, 수동 계산과 100% 일치)

> 💡 **CN 타입 가격 계산은 v1.1에서 구현** (원가 입력 필요)
>
> 📋 **현재 구현된 계산 방식** (MVP 1.0):
>
> - **US 타입**: `판매가 = 아마존가격 × (1 + 마진율/100)`
> - **CN 타입**: `판매가 = (원가 + 배송비 + 추가비용) / (1 - 마진율/100)` (v1.1 UI 구현 예정)
> - 마진율: 사용자가 직접 입력 (기본값 40%)
> - 유효성 검증: 가격 > 0, 마진율 0-100% 범위
>
> 🔮 **추후 개선 가능 사항** (Post-MVP Phase 2.5 참조):
>
> - 마진율 수식 관리 (카테고리별, 가격대별 자동 적용)
> - US 타입 배송비 항목 추가
> - 추가 비용 항목 확장 (관세, 플랫폼 수수료 등)
> - 가격 정책 템플릿 및 시뮬레이션
>
> 📄 **관련 문서:**
>
> - [가격 계산 정확도 검증 보고서](./price-calculation-verification.md)
> - [단위 테스트 파일](../lib/pricing/__tests__/calculator.test.ts)

---

## 🌉 Phase 2 (보류): 이미지 검색 브릿지 ⚠️ 미완료

**기간:** 12/25 (1일) → **보류됨 (2024-12-09)**  
**상태:** ⚠️ **Shopify 테스트 등록 완료 후 재구현 예정**

### 목표

이미지 클릭 시 타오바오/1688.com 이미지 검색 새 탭 열기 (원가 확인용)

### 2.17 이미지 검색 브릿지 구현 (보류 중) ⚠️

- [x] ProductList의 이미지에 클릭 이벤트 추가 (UI만 구현됨)
- [ ] ⚠️ **타오바오 이미지 검색 연동** - 외부 이미지 URL 미지원으로 실패
- [ ] ⚠️ **1688.com 이미지 검색 연동** - 검색 결과 없음 문제 발생
- [x] 새 탭으로 열기 (`window.open`) - 구현 완료
- [x] 이미지 hover 시 커서 변경 (pointer) 및 툴팁 표시 - 구현 완료

### 🚧 미완료 상태

- [ ] 이미지 클릭 시 실제 검색 결과가 나타나지 않음
- [ ] 대안 방법 모색 필요:
  - [ ] Google Lens API 조사
  - [ ] 이미지 다운로드 후 재업로드 방식 검토
  - [ ] Chrome Extension 활용 방안 검토
  - [ ] 수동 검색 가이드 제공 (임시 방안)

> ⚠️ **보류 사유** (2024-12-09)
>
> - 타오바오: 외부 이미지 URL을 직접 전달하는 방식 미지원
> - 1688.com: 이미지 URL 전달해도 검색 결과 없음
> - **결정**: Shopify 테스트 등록까지 구현 완료 후, 검증된 해결책으로 재구현
>
> **임시 대응**:
>
> - 현재는 이미지 클릭 시 1688.com 검색 페이지만 열림
> - 사용자는 수동으로 이미지 검색 수행 필요

---

## 🛒 Phase 2 (완료): Shopify 일괄 등록

**기간:** 12/26 - 12/29 (4일)

### 목표

체크박스로 선택한 상품들을 Shopify에 일괄 등록 (필수 기능)

### 2.18 환경 변수 설정 (12/26, 0.5일) ✅ 완료 (2024-12-09)

- [x] `.env` 파일에 Shopify 정보 추가
  - [x] SHOPIFY_STORE_URL (`https://talentmark.myshopify.com`)
  - [x] SHOPIFY_ACCESS_TOKEN (발급 완료)
  - [x] SHOPIFY_API_VERSION (`2025-01`)
- [x] 연결 테스트 API 생성 (`/api/shopify/test`)
  - [x] Shop API 호출하여 스토어 정보 조회
  - [x] 환경변수 유효성 검증
  - [x] 에러별 문제 해결 가이드 제공

### 2.19 Shopify API 클라이언트 (12/26-12/27, 1.5일) ✅ 완료 (2024-12-09)

- [x] `lib/shopify/client.ts` 생성
  - [x] `createProduct()` 함수
    - [x] 상품 생성 API 호출
    - [x] 이미지 URL 배열 전달 (최대 10개)
  - [x] `uploadProductImages()` 함수 (필요시) - createProduct에 통합
  - [x] 에러 핸들링 (Rate Limit, Network Error 등)
  - [x] 재시도 로직 (최대 3회, 지수 백오프)
- [x] `types/shopify.ts` 생성 (Shopify API 타입 정의)
- [x] `lib/shopify/__tests__/client.test.ts` 생성 (단위 테스트)

### 2.20 일괄 등록 API (12/28, 1.5일) ✅ 완료 (2024-12-09)

- [x] `app/api/shopify/bulk-upload/route.ts` 생성
  - [x] POST 요청 핸들러
  - [x] `product_ids` 배열 수신
  - [x] 각 상품 검증
    - [x] selling_price > 0 확인
    - [x] 필수 필드 존재 확인
  - [x] 순차적 Shopify 등록 (병렬 처리 지양)
  - [x] Status 업데이트 (uploaded/error)
  - [x] 진행 상황 및 결과 반환
  - [x] Rate Limit 방지를 위한 0.5초 딜레이 추가
  - [x] 에러 메시지 저장 (error_message 필드)

### 2.21 대시보드 통합 (12/29, 0.5일) ✅ 완료 (2024-12-09)

- [x] "선택 등록" 버튼 활성화
- [x] 선택된 상품 없을 시 버튼 비활성화
- [x] 클릭 시 일괄 등록 API 호출
- [x] 로딩 상태 표시 ("등록 중...")
- [x] 성공/실패 카운트 표시
- [x] 리스트 새로고침 (Status 업데이트 반영)
- [x] 선택 초기화

### ✅ Shopify 연동 완료 조건

- [x] Shopify 연결 성공 (환경 변수 설정 완료) ✅ **2024-12-09 완료**
- [x] **체크한 상품들이 Shopify에 등록됨** ✅ **2024-12-09 완료**
- [x] Shopify Dashboard에서 상품 확인 가능 ✅ **2024-12-09 완료**
- [x] Status가 "uploaded"로 변경됨 ✅ **2024-12-09 완료**
- [x] 에러 발생 시 Status가 "error"로 변경되고 메시지 표시 ✅ **2024-12-09 완료**
- [x] 등록 성공률 95% 이상 달성 ✅ **2024-12-09 완료**

> 🎉 **Phase 2.20-2.21 Shopify 일괄 등록 완료!** (2024-12-09)
>
> - 일괄 등록 API 구현 완료
> - 대시보드 통합 완료
> - 정상 작동 확인 (테스트 통과)
>
> ⚠️ **알려진 개선 사항** (Post-MVP Phase 2.22에서 구현 예정):
>
> - 카테고리 자동 설정 기능 미구현 (현재: "General"로 고정)
> - 이미지 중복 등록 문제 (동일 이미지가 4-5개씩 등록됨)
>
> 📄 **테스트 가이드:** [phase-2-21-bulk-upload-test-guide.md](./phase-2-21-bulk-upload-test-guide.md)

---

## 🔄 Phase 2.5: 순차 처리 구현 (E2E 테스트 전 필수)

**기간:** 12/29 - 01/04 (7일)  
**상태:** 🔄 진행 중

### 목표

기존 동기식 수집 방식을 순차 처리 방식으로 전환. 1분당 1개씩 수집하고, 각 상품마다 DB 저장 및 Shopify 자동 등록까지 완료한 후 다음 상품으로 진행.

### 2.22 순차 처리 Job 시스템 (12/29, 1일) ✅ 완료

- [x] `scraping_jobs` 및 `scraping_job_items` 테이블 마이그레이션 생성 ✅ **이미 존재 (20251215153310_create_scraping_jobs_table.sql)**
- [x] `lib/scraper/sequential-scraper.ts` 생성 ✅ **완료**
  - [x] `startSequentialScraping()` 함수 (Job 생성 및 백그라운드 작업 시작)
  - [x] `processSequentialScraping()` 함수 (순차 처리 루프)
  - [x] `getJobProgress()` 함수 (진행 상황 조회)
  - [x] `getJobInfo()` 함수 (Job 정보 조회)
- [x] `lib/scraper/amazon-scraper.ts` 수정 ✅ **완료**
  - [x] `scrapeSingleProduct()` 함수 추가 (1개 상품만 수집)
  - [x] 페이지네이션 제한 해제 (1000개 지원)

### 2.23 순차 처리 API 및 진행 상황 조회 (12/29, 0.5일) ✅ 완료

- [x] `app/api/scrape/route.ts` 수정 ✅ **완료**
  - [x] POST 핸들러를 비동기 Job 시작 방식으로 변경
  - [x] 즉시 응답 (202 Accepted) 및 Job ID 반환
  - [x] 사용자 인증 추가
- [x] `app/api/scrape/[jobId]/route.ts` 생성 ✅ **완료**
  - [x] GET 핸들러 (진행 상황 조회)
  - [x] 사용자 권한 확인
- [x] `app/api/scrape/[jobId]/stream/route.ts` 생성 ✅ **완료**
  - [x] SSE 엔드포인트 (선택사항)

### 2.24 진행 상황 UI 통합 (12/30, 0.5일) ✅ 완료

- [x] `hooks/use-scraping-progress.ts` 생성 ✅ **완료**
  - [x] Polling 방식 진행 상황 조회
  - [x] 자동 새로고침 (5초 간격)
- [x] `components/ScrapingProgress.tsx` 생성 ✅ **완료**
  - [x] 진행률 바
  - [x] 현재/목표 개수 표시
  - [x] 예상 남은 시간 계산 및 표시
  - [x] 성공/실패 개수 표시
- [x] `app/dashboard/page.tsx` 수정 ✅ **완료**
  - [x] `handleScrape()` 함수 수정 (Job ID 받기)
  - [x] `ScrapingProgress` 컴포넌트 통합
  - [x] Job 완료 시 콜백 처리

### 2.25 에러 처리 및 재시도 로직 강화 (12/30, 0.5일) ✅ 완료

- [x] `lib/scraper/sequential-scraper.ts` 에러 처리 강화 ✅ **완료**
  - [x] 수집 실패 시 재시도 로직 (최대 2회, 지수 백오프)
  - [x] DB 저장 실패 시 재시도 로직 (최대 1회)
  - [x] Shopify 등록 실패 시 재시도 로직 (최대 1회)
  - [x] 각 단계별 try-catch 및 에러 메시지 저장

### 2.26 CN 타입 가격 계산 (12/31 - 01/02, 2일) 🔄 진행 중

- [ ] Cost Price 입력 필드 추가
- [ ] Type 선택 드롭다운 (US/CN)
- [ ] CN 타입 계산 로직 구현: `(costPrice + shipping + extra) / (1 - marginRate)`
- [ ] 검증 로직 추가 (CN 타입일 때 cost_price 필수)
- [ ] UI 통합 (ProductList 컴포넌트)
- [ ] API 업데이트 (상품 업데이트 시 CN 타입 처리)

### 2.27 타오바오 이미지 검색 브릿지 재구현 (01/02 - 01/03, 2일) 🔄 진행 중

- [ ] 외부 이미지 URL 문제 해결 방안 모색
  - [ ] Google Lens API 조사
  - [ ] 이미지 다운로드 후 재업로드 방식 검토
  - [ ] Chrome Extension 활용 방안 검토
- [ ] 선택한 대안 방법 구현
- [ ] 이미지 클릭 시 타오바오 검색 결과 페이지 연결
- [ ] 테스트 및 검증

### 2.28 스크래핑 요소 추가 (01/03 - 01/04, 2일) 🔄 진행 중

- [ ] 리뷰수 수집 로직 추가
- [ ] 평점 수집 로직 추가
- [ ] DB 스키마 확장 (필요시)
  - [ ] `products` 테이블에 `review_count`, `rating` 컬럼 추가
- [ ] 스크래퍼 로직 업데이트 (`lib/scraper/amazon-scraper.ts`)
- [ ] UI 표시 (ProductList 컴포넌트)

### ✅ Phase 2.5 완료 조건

- [x] 순차 처리 Job 시스템 구현 완료 ✅ **2024-12-15 완료**
- [x] API 및 진행 상황 조회 기능 구현 완료 ✅ **2024-12-15 완료**
- [x] 진행 상황 UI 통합 완료 ✅ **2024-12-15 완료**
- [x] 에러 처리 및 재시도 로직 구현 완료 ✅ **2024-12-15 완료**
- [ ] CN 타입 가격 계산 구현 완료
- [ ] 타오바오 이미지 검색 브릿지 재구현 완료
- [ ] 스크래핑 요소 추가 완료 (리뷰수, 평점)
- [ ] 작은 규모 테스트 (5개 수집) 성공 (E2E 테스트에서 검증)
- [ ] 중간 규모 테스트 (30개 수집) 성공 (E2E 테스트에서 검증)
- [ ] 하루 최대 1000개 수집 가능한지 확인 (E2E 테스트에서 검증)

> 💡 **Phase 2.5는 E2E 테스트 전 필수 작업입니다.**
>
> - 기존 동기식 수집 방식 (한 번에 30개)은 Phase 2.3-2.5에서 구현됨
> - 순차 처리 방식 (1분당 1개)은 Phase 2.5에서 구현됨
> - E2E 테스트는 순차 처리 방식으로 진행됨
>
> 📄 **구현 완료 파일:**
>
> - `lib/scraper/sequential-scraper.ts` (순차 처리 로직)
> - `lib/scraper/amazon-scraper.ts` (1개 수집 함수 추가)
> - `app/api/scrape/route.ts` (비동기 Job 시작)
> - `app/api/scrape/[jobId]/route.ts` (진행 상황 조회)
> - `app/api/scrape/[jobId]/stream/route.ts` (SSE 스트리밍)
> - `hooks/use-scraping-progress.ts` (진행 상황 Hook)
> - `components/ScrapingProgress.tsx` (진행 상황 UI)
> - `app/dashboard/page.tsx` (대시보드 통합)

---

## 🧪 Phase 3: 테스트 & 런칭

**기간:** 12/30 - 01/09 (11일)  
**버퍼:** 5일 (충분한 여유)  
**전제 조건:** Phase 2.5 (순차 처리 구현) 완료 필수

### 목표

전체 플로우 테스트 및 MVP 1.0 배포

### 3.1 E2E 테스트 (12/30-01/02, 4일)

- [ ] **전체 플로우 10회 반복 테스트**
  1. [ ] 트렌드 숏컷 → 외부 사이트 이동 확인
  2. [ ] 키워드 입력 → 순차 처리 시작 (하루 최대 1000개) → 진행 상황 표시 확인
  3. [ ] 순차 처리 진행 상황 실시간 업데이트 확인 (Polling 방식)
  4. [ ] 1분당 1개씩 수집되는지 확인
  5. [ ] 각 상품이 수집 → DB 저장 → Shopify 자동 등록 순서로 처리되는지 확인
  6. [ ] 금지어 필터링 동작 확인
  7. [ ] 이미지 클릭 → 타오바오 검색 페이지 열림
  8. [ ] 마진율 입력 → 판매가 자동 계산
  9. [ ] 체크박스 선택 → Shopify 일괄 등록 (기존 방식도 테스트)
  10. [ ] Shopify Dashboard에서 상품 확인
- [ ] **다양한 테스트 케이스**
  - [ ] 작은 규모 테스트: 5개 수집 (약 5분)
  - [ ] 중간 규모 테스트: 30개 수집 (약 30분)
  - [ ] 여러 키워드로 테스트 (5개 이상)
  - [ ] URL 직접 입력 테스트
  - [ ] 빈 리스트 상태 확인
  - [ ] 에러 케이스 확인 (잘못된 URL, 네트워크 에러 등)
  - [ ] Job 진행 상황 조회 API 테스트
  - [ ] 진행 상황 UI 표시 정확도 확인

### 3.2 KPI 검증 (01/02, 0.5일)

- [ ] **소싱 속도:** 1분당 1개씩 수집 확인 (하루 최대 1000개 수집 가능, 약 16.7시간 소요)
- [ ] **매칭 효율:** 타오바오 이미지 검색 1클릭 확인
- [ ] **등록 성공률:** 95% 이상 달성 확인
- [ ] **순차 처리:** 1개 수집 → 등록 완료 → 다음 수집 진행 확인

### 3.3 버그 수정 (01/03-01/06, 4일) ⭐ 주요 버퍼

- [ ] 발견된 버그 목록 작성 및 우선순위 분류
  - [ ] Critical: 즉시 수정 필요
  - [ ] High: 런칭 전 수정 필요
  - [ ] Medium: 런칭 후 수정 가능
- [ ] Critical/High 우선순위 버그 수정
- [ ] 수정 후 재테스트

### 3.4 배포 준비 (01/07-01/08, 2일)

- [ ] 환경변수 프로덕션 설정
  - [ ] Supabase 프로덕션 URL/Key 확인
  - [ ] Shopify 프로덕션 Access Token 확인
  - [ ] Clerk 프로덕션 키 확인
- [ ] Vercel 배포
  - [ ] 빌드 에러 해결
  - [ ] 환경변수 설정
  - [ ] 도메인 연결 (선택 사항)
- [ ] 프로덕션 환경 테스트
  - [ ] 전체 플로우 1회 이상 테스트
  - [ ] 성능 확인 (로딩 속도 등)

### 3.5 최종 점검 (01/09, 1일) ⭐ 예비일

- [ ] 런칭 체크리스트 완료
- [ ] 문서 업데이트 (README, 사용 가이드 등)
- [ ] 백업 계획 확인
- [ ] 모니터링 도구 설정 (Sentry 등, 선택 사항)

### ✅ Phase 3 완료 조건

- [ ] 전체 플로우가 안정적으로 작동함
- [ ] Critical/High 버그가 모두 수정됨
- [ ] KPI 목표 달성 확인
- [ ] 프로덕션 배포 완료
- [ ] 실제 사용 가능한 상태

---

## 🚀 MVP 1.0 런칭

**런칭일:** 2026-01-10

### 포함 기능

✅ 아마존 30개 수집  
✅ 금지어 자동 필터링  
✅ 체크박스 선택 UI  
✅ 타오바오 이미지 검색 브릿지  
✅ US 타입 가격 자동 계산  
✅ Shopify 일괄 등록

---

## 📈 Post-MVP: v1.1 기능 확장

**기간:** 01/11 - 01/24 (14일)  
**목표:** 정식 v1.1 런칭

### Post-1: 50개 수집으로 확장 (2일)

> 💡 **참고**: 스크래핑 요소 추가(리뷰수, 평점)는 Phase 2.5 (2.28)에서 구현 중입니다.
>
> - Phase 2.5 섹션의 2.28 항목 참조

- [ ] 페이지네이션 로직 확장 (4-5 페이지)
- [ ] 진행 상황 실시간 표시 ("수집 중... 35/50")
- [ ] KPI 재검증 (50개 30초 이내)

### Post-2: CN 타입 가격 계산 (3일) → **Phase 2.5로 이동**

> ⚠️ **참고**: CN 타입 가격 계산은 Phase 2.5 (2.26)에서 구현 중입니다.
>
> - Phase 2.5 섹션의 2.26 항목 참조

### Post-2.22: Shopify 등록 품질 개선 (선택 사항, 1-2일)

> 💡 **E2E 검증 완료 후 심화 단계에서 구현**

**발견된 개선 사항** (2024-12-09 테스트 결과):

- [ ] **카테고리 자동 설정**

  - [ ] 현재: 모든 상품이 "General" 카테고리로 등록됨
  - [ ] 개선: 아마존 카테고리 정보 스크래핑
  - [ ] 아마존 카테고리 → Shopify 카테고리 매핑 테이블 생성
  - [ ] `lib/shopify/client.ts`에서 `product_type` 자동 설정

- [ ] **이미지 중복 제거**
  - [ ] 현재: 동일한 이미지 URL이 4-5개씩 중복 등록됨
  - [ ] 개선: 이미지 URL 배열에서 중복 제거 로직 추가
  - [ ] `lib/shopify/client.ts`의 `formatProductForShopify` 함수 수정
  - [ ] 중복 제거 후 최대 10개까지만 등록

**우선순위**: Low (MVP 1.0 기능에는 영향 없음, 사용자 경험 개선)

> ⚠️ **구현 시점**: Phase 3 (E2E 테스트) 완료 후 결정

### Post-2.5: 가격 계산 시스템 개선 (선택 사항, 2-3일)

> 💡 **개선 가능성**: MVP 1.0 테스트 완료 후, 아래 항목들을 검토하여 필요시 구현

- [ ] **마진율 수식 관리**
  - [ ] 현재: 고정값 입력 (예: 40%)
  - [ ] 개선: 수식 기반 마진율 자동 계산
    - [ ] 예: `기본마진(40%) + 카테고리별가산(10%) - 경쟁상품할인(5%)`
  - [ ] 마진율 프리셋 관리 (카테고리별, 가격대별)
- [ ] **US 타입 배송비 항목 추가**
  - [ ] 현재: `amazonPrice × (1 + marginRate / 100)`
  - [ ] 개선: `(amazonPrice + shippingFee) × (1 + marginRate / 100)`
  - [ ] 배송비 입력 필드 추가 (선택 사항)
- [ ] **가격 계산 공식 커스터마이징**
  - [ ] 관리자 설정에서 계산 공식 선택
  - [ ] 여러 가격 정책 템플릿 제공
  - [ ] 공식 미리보기 및 시뮬레이션 기능
- [ ] **추가 비용 항목 확장**
  - [ ] 관세 비용 (customs)
  - [ ] 플랫폼 수수료 (platform fee)
  - [ ] 포장 비용 (packaging)
  - [ ] 기타 비용 (miscellaneous)

> ⚠️ **결정 시점**: Phase 3 테스트 단계에서 실제 사용 피드백 기반으로 우선순위 결정

### Post-3: 중국어 이미지 필터링 (2일)

- [ ] `lib/utils/image-filter.ts` 생성
- [ ] `containsChinese()` 함수 (OCR 또는 파일명 기반)
- [ ] 이미지 갤러리에 필터 옵션 추가

### Post-4: UX 개선 (3일)

- [ ] Toast 알림 시스템 (성공/에러/경고)
- [ ] 로딩 스피너 개선
- [ ] 타임아웃 처리 (60초)
- [ ] 반응형 디자인 (모바일 대응)

### Post-5: 상세 편집 기능 (4일, 선택 사항)

- [ ] `components/ProductEditor.tsx` 생성
- [ ] 이미지 갤러리 슬라이더
- [ ] 상품명/설명 편집 UI
- [ ] 개별 Shopify 등록

---

**현재 진행 상황:**

- ✅ Phase 1 완료 (최소 UI 구성)
- ✅ Phase 0-1 완료 (개발 환경 확인)
- ✅ Phase 0-2 진행 중 (Shopify 스토어 개설 완료, Access Token 발급 완료)
- ✅ Phase 2.1 완료 (환경 구성 - Puppeteer 설치 및 타입 정의)
- ✅ Phase 2.2 완료 (URL 처리 유틸리티)
- ✅ Phase 2.3 완료 (아마존 스크래핑 로직) **2024-12-04 완료**
- ✅ Phase 2.4 완료 (스크래핑 API Route + Rate Limiting) **2024-12-04 완료**
  - ✅ 개발/프로덕션 환경 분리
  - ✅ Bot Detection 대응 (IP별 요청 제한)
  - ✅ 프로덕션: 엄격한 제한 (60초 간격, 5분에 3회)
  - ✅ 개발: 제한 없음 (빠른 테스트)
- ✅ Phase 2.5 완료 (대시보드 연동) **2024-12-04 완료**
- ✅ Phase 2.6 완료 (Products 테이블 마이그레이션) **2024-12-04 완료**
- ✅ Phase 2.7 완료 (Banned Keywords 테이블 마이그레이션) **2024-12-04 완료**
- ✅ Phase 2.8 완료 (마이그레이션 실행) **2024-12-04 완료**
- ✅ Phase 2.9 완료 (금지어 필터링) **2024-12-08 완료**
  - ✅ 필터링 함수 구현
  - ✅ Supabase 조회 및 통합
  - ✅ 23개 → 18개 필터링 성공 (5개 제거)
- ✅ Phase 2.10 완료 (DB 저장 로직) **2024-12-08 완료**
  - ✅ Clerk 인증 통합
  - ✅ 가격 유효성 검증
  - ✅ 스크래퍼 가격 추출 개선
  - ✅ 18개 중 17개 저장 성공
- ✅ Phase 2.11 완료 (상품 조회 API) **2024-12-08 완료**
  - ✅ GET /api/products 구현
  - ✅ 페이지네이션 지원
  - ✅ 최신순 정렬
- ✅ Phase 2.12 완료 (상품 리스트 컴포넌트) **2024-12-08 완료**
  - ✅ ProductList 컴포넌트 생성
  - ✅ 체크박스 선택 기능
  - ⚠️ 이미지 검색 브릿지 (미완료, Phase 2.17 참조)
  - ✅ 반응형 테이블
- ✅ Phase 2.13 완료 (대시보드 통합) **2024-12-08 완료**
  - ✅ 페이지 로드 시 상품 목록 자동 조회
  - ✅ 수집 완료 후 자동 새로고침
  - ✅ 선택 등록 버튼 추가
- ✅ **Phase 2.14-2.17 완료** (US 타입 가격 자동 계산) **2024-12-09 완료**
  - ✅ 가격 계산 로직 (lib/pricing/calculator.ts)
  - ✅ ProductList UI 업데이트 (마진율 입력)
  - ✅ 상품 업데이트 API (PATCH /api/products/[id])
  - ✅ 대시보드 통합 (handleMarginChange)
  - ✅ **단위 테스트 작성** (30개 테스트, 100% 통과) **2024-12-09 완료**
  - ✅ **정확도 검증 및 문서화** (10개 시나리오 검증 완료) **2024-12-09 완료**
- ⚠️ **Phase 2.17 보류** (이미지 검색 브릿지) **2024-12-09**
  - ⚠️ 타오바오/1688.com 외부 이미지 검색 미작동
  - ⚠️ Shopify 테스트 등록 완료 후 재구현 예정
- ✅ **Phase 2.18 완료** (Shopify 환경 변수 설정) **2024-12-09**
  - ✅ .env 파일에 Shopify 정보 추가 (URL, Access Token, API Version)
  - ✅ 연결 테스트 API 생성 (/api/shopify/test)
- ✅ **Phase 2.19 완료** (Shopify API 클라이언트) **2024-12-09**
  - ✅ lib/shopify/client.ts 생성 (createProduct 함수)
  - ✅ types/shopify.ts 생성 (Shopify API 타입 정의)
  - ✅ 에러 핸들링 및 재시도 로직 (지수 백오프, 최대 3회)
  - ✅ Rate Limit 대응 (429 에러 자동 재시도)
  - ✅ 이미지 최대 10개 지원
  - ✅ 단위 테스트 작성 (lib/shopify/**tests**/client.test.ts)
- ✅ **Phase 2.20-2.21 완료** (Shopify 일괄 등록) **2024-12-09**
  - ✅ app/api/shopify/bulk-upload/route.ts 생성
  - ✅ 일괄 등록 API 구현 (순차적 처리, Rate Limit 대응)
  - ✅ 대시보드 통합 (선택 등록 버튼, 로딩 상태, 메시지 표시)
  - ✅ 정상 작동 확인 (테스트 통과)
  - ⚠️ 개선 필요 사항 발견 (카테고리 미설정, 이미지 중복) → Post-MVP Phase 2.22에서 구현 예정
- 🔄 **Phase 2.5 진행 중** (순차 처리 구현)
  - ✅ lib/scraper/sequential-scraper.ts 생성 (순차 처리 로직) **2024-12-15 완료**
  - ✅ lib/scraper/amazon-scraper.ts 수정 (1개 수집 함수, 페이지네이션 제한 해제) **2024-12-15 완료**
  - ✅ app/api/scrape/route.ts 수정 (비동기 Job 시작) **2024-12-15 완료**
  - ✅ app/api/scrape/[jobId]/route.ts 생성 (진행 상황 조회) **2024-12-15 완료**
  - ✅ app/api/scrape/[jobId]/stream/route.ts 생성 (SSE 스트리밍) **2024-12-15 완료**
  - ✅ hooks/use-scraping-progress.ts 생성 (진행 상황 Hook) **2024-12-15 완료**
  - ✅ components/ScrapingProgress.tsx 생성 (진행 상황 UI) **2024-12-15 완료**
  - ✅ app/dashboard/page.tsx 수정 (대시보드 통합) **2024-12-15 완료**
  - ✅ 에러 처리 및 재시도 로직 강화 **2024-12-15 완료**
  - 🔄 CN 타입 가격 계산 (2.26) 진행 중
  - 🔄 타오바오 이미지 검색 브릿지 재구현 (2.27) 진행 중
  - 🔄 스크래핑 요소 추가 (2.28) 진행 중
- 🔄 Phase 0-3 예정 (PG 연동 시작)

**다음 작업:** Phase 3 (E2E 테스트 & 런칭) 시작

**MVP 1.0 목표일:** 2026-01-10  
**v1.1 목표일:** 2026-01-24
