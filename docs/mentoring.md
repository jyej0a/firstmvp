# 멘토님께 드릴 질문 (개발 관련)

## 프로젝트 간단 소개

안녕하세요 멘토님!

저는 **Trend-Hybrid Admin**이라는 프로젝트를 진행하고 있습니다.

**프로젝트가 하는 일:**

- 틱톡에서 인기 있는 상품을 발견하면
- 아마존에서 그 상품 정보를 자동으로 가져와서 (스크래핑)
- Shopify 내 쇼핑몰에 자동으로 등록해주는 도구입니다

**기술 스택:**

- Next.js 15 (프론트엔드 + 백엔드)
- Supabase (데이터베이스)
- Puppeteer (아마존에서 상품 정보 가져오기)
- Shopify API (상품 등록)

**현재 상황:**

- 기본 기능은 다 만들었습니다 (상품 수집, 필터링, Shopify 등록)
- 그런데 최근에 전략을 바꿨습니다
- **이전:** 30개 상품을 30초 안에 한 번에 수집
- **지금:** 1분에 1개씩 천천히 수집 (아마존이 봇으로 인식해서 차단하는 걸 피하기 위해)

**문제점:**

- 현재 코드는 "한 번에 30개 수집" 방식으로 되어 있어서
- "1분에 1개씩 순차적으로 수집" 방식으로 바꿔야 합니다
- 그런데 어떻게 바꿔야 할지 막막합니다

---

## 질문 1: 순차 처리 구현 방법

**질문:**
지금은 사용자가 "수집 시작" 버튼을 누르면 30개를 한 번에 가져오는데, 이걸 "1개 가져오기 → Shopify에 등록 → 다음 1개 가져오기" 이렇게 순서대로 처리하려면 어떻게 해야 하나요?

**현재 코드 구조:**

- `/api/scrape` 라는 API가 있어서 한 번 호출하면 30개를 다 가져옵니다
- 이걸 30번 호출하는 게 아니라, 한 번 호출했을 때 안에서 1개씩 처리하도록 바꿔야 할 것 같은데...

**궁금한 점:**

- 이렇게 오래 걸리는 작업(30분)을 어떻게 처리해야 하나요?
- 사용자 화면에는 "진행 중... 5/30 완료" 이렇게 보여줘야 하는데...

---

## 질문 2: 실시간 화면 업데이트

**질문:**
사용자가 수집 버튼을 누르면, 수집된 상품이 하나씩 화면에 나타나야 합니다. 어떻게 하면 서버에서 작업하는 내용을 실시간으로 화면에 보여줄 수 있나요?

**예시:**

- 사용자가 버튼 클릭
- 1분 후: "상품 1개 수집 완료!" → 화면에 표시
- 1분 후: "상품 2개 수집 완료!" → 화면에 추가 표시
- ... 이런 식으로

**궁금한 점:**

- 서버에서 작업하는 중에 화면을 자동으로 업데이트하려면 어떻게 해야 하나요?
- 새로고침 없이 자동으로 목록이 추가되는 방법이 있나요?

---

## 질문 3: 요청 제한(Rate Limiting) 적용 방법

**질문:**
지금 `rate-limiter.ts`라는 파일이 있는데, 이건 "1분에 1번만 요청 가능"하게 막는 기능입니다. 그런데 이걸 순차 수집에 어떻게 적용해야 할까요?

**현재 상황:**

- Rate Limiter는 API 요청이 들어올 때 체크합니다
- 그런데 순차 수집은 한 번 요청으로 30개를 처리해야 하니까...

**궁금한 점:**

- 순차 수집 안에서 각 상품을 가져올 때마다 Rate Limit을 체크해야 하나요?
- 아니면 다른 방식이 있나요?

---

## 질문 4: 에러 처리 방법

**질문:**
30개를 순차적으로 수집하는 중에, 만약 5번째 상품을 가져오다가 실패하면 어떻게 해야 하나요?

**시나리오:**

- 1~4번째 상품: 성공
- 5번째 상품: 아마존이 차단해서 실패
- 6~30번째 상품: 어떻게 할까요?

**궁금한 점:**

- 실패한 건 건너뛰고 계속 진행해야 하나요?
- 아니면 처음부터 다시 해야 하나요?
- 사용자에게는 어떻게 알려줘야 하나요?

---

## 질문 5: 여러 사용자가 동시에 사용할 때

**질문:**
나중에 여러 사람이 동시에 이 도구를 사용하면 문제가 생길까요?

**예시:**

- 사용자 A가 30개 수집 시작 (30분 소요)
- 사용자 B가 동시에 30개 수집 시작
- 둘 다 같은 서버에서 Puppeteer를 돌리면...

**궁금한 점:**

- 서버가 느려지거나 에러가 날 수 있나요?
- 미리 대비해야 할 게 있나요?

---

## 질문 6: 진행 상황 표시 방법

**질문:**
사용자 화면에 "30개 중 5개 완료, 예상 남은 시간: 25분" 이렇게 보여주려면 어떻게 해야 하나요?

**필요한 기능:**

- 지금 몇 개나 수집했는지
- 앞으로 얼마나 더 걸릴지
- 각 상품이 성공했는지 실패했는지

**궁금한 점:**

- 이 정보를 어디에 저장해야 하나요? (데이터베이스? 메모리?)
- 화면에서 이 정보를 어떻게 가져오나요?

---

## 질문 7: 아마존 차단 피하기

**질문:**
아마존이 봇으로 인식해서 차단하는 걸 피하려면, 1분에 1개씩 수집하는 것 외에 더 할 수 있는 게 있나요?

**현재 하고 있는 것:**

- User-Agent 설정 (브라우저인 것처럼 위장)
- 요청 사이에 1~3초 랜덤 대기
- 1분에 1번만 요청

**궁금한 점:**

- 더 안전하게 하려면 뭘 더 해야 하나요?
- 프록시 같은 걸 써야 하나요? (비용이 많이 드나요?)

---

## 추가 정보 (필요하시면)

**현재 코드 위치:**

- 스크래핑 API: `app/api/scrape/route.ts`
- Rate Limiter: `lib/utils/rate-limiter.ts`
- 스크래퍼 로직: `lib/scraper/amazon-scraper.ts`

**프로젝트 문서:**

- PRD: `docs/PRD.md` (프로젝트 전체 계획서)
- TODO: `docs/TODO.md` (개발 체크리스트)

---

감사합니다! 🙏
