# íŠ¸ëŸ¬ë¸”ìŠˆíŒ… - 261223: V1 (Original), V1 (Current), V2ì˜ ê¸°ëŠ¥ì  ì°¨ì´ì  ë¶„ì„ ë³´ê³ ì„œ

**ì‘ì„±ì¼**: 2025-12-23  
**ì—…ë°ì´íŠ¸ì¼**: 2025-01-05  
**ëª©ì **: V1 (Original), V1 (Current), V2 ì‹œìŠ¤í…œì˜ ê¸°ëŠ¥ì  ì°¨ì´ì ì„ ëª…í™•íˆ í•˜ê³ , ê° ì‹œìŠ¤í…œì˜ êµ¬í˜„ ìƒíƒœë¥¼ ì ê²€í•˜ì—¬ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥ ì—¬ë¶€ë¥¼ í™•ì¸

---

## ğŸ“‹ ëª©ì°¨

1. [V1 (Original), V1 (Current), V2ì˜ í•µì‹¬ ì°¨ì´ì ](#v1-original-v1-current-v2ì˜-í•µì‹¬-ì°¨ì´ì )
2. [3-way ë¹„êµ í…Œì´ë¸”](#3-way-ë¹„êµ-í…Œì´ë¸”)
3. [ì£¼ìš” ì°¨ì´ì  ìƒì„¸ ë¶„ì„](#ì£¼ìš”-ì°¨ì´ì -ìƒì„¸-ë¶„ì„)
4. [êµ¬í˜„ ìƒíƒœ ì ê²€](#êµ¬í˜„-ìƒíƒœ-ì ê²€)
5. [ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°](#ë°ì´í„°ë² ì´ìŠ¤-êµ¬ì¡°)
6. [API ì—”ë“œí¬ì¸íŠ¸ ë¹„êµ](#api-ì—”ë“œí¬ì¸íŠ¸-ë¹„êµ)
7. [ëŒ€ì‹œë³´ë“œ UI ë¹„êµ](#ëŒ€ì‹œë³´ë“œ-ui-ë¹„êµ)
8. [í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸](#í…ŒìŠ¤íŠ¸-ì²´í¬ë¦¬ìŠ¤íŠ¸)
9. [ì•Œë ¤ì§„ ì´ìŠˆ ë° ìˆ˜ì • í•„ìš” ì‚¬í•­](#ì•Œë ¤ì§„-ì´ìŠˆ-ë°-ìˆ˜ì •-í•„ìš”-ì‚¬í•­)

---

## V1 (Original), V1 (Current), V2ì˜ í•µì‹¬ ì°¨ì´ì 

### V1 (Original) - ì»¤ë°‹ 786690b (ì›ë³¸ ë²„ì „)

**ì°¸ì¡° ì»¤ë°‹**: `786690b` (2025-12-12)

| í•­ëª©                       | V1 (Original) íŠ¹ì§•                                                    |
| -------------------------- | --------------------------------------------------------------------- |
| **ì¸ì¦**                   | API ë ˆë²¨ ì¸ì¦ ì—†ìŒ, `saveProductsToDatabase` ë‚´ë¶€ì—ì„œë§Œ ì¸ì¦          |
| **ìŠ¤í¬ë˜í•‘ ë°©ì‹**          | 30ê°œ ìƒí’ˆì„ í•œ ë²ˆì— ì¼ê´„ ìˆ˜ì§‘                                         |
| **ì‘ë‹µ ë°©ì‹**              | ë™ê¸°ì‹ (ìˆ˜ì§‘ ì™„ë£Œ í›„ ê²°ê³¼ ë°˜í™˜, HTTP 200)                             |
| **ë°ì´í„° ì €ì¥**            | `products` í…Œì´ë¸” ì‚¬ìš©                                                |
| **saveProductsToDatabase** | userId íŒŒë¼ë¯¸í„° ì—†ìŒ, í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ `auth()` í˜¸ì¶œ                     |
| **ìŠ¤í¬ë˜í¼ ì˜µì…˜**          | `{ maxProducts: 30, timeout: 60000, headless: true, verbose: false }` |
| **forceEnglish**           | ì—†ìŒ (ì˜µì…˜ ìì²´ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŒ)                                      |
| **ì—ëŸ¬ ì²˜ë¦¬**              | ìƒì„¸í•œ ì—ëŸ¬ íƒ€ì…ë³„ ì²˜ë¦¬ (timeout, network, blocked, captcha ë“±)       |
| **Shopify ë“±ë¡**           | ìˆ˜ë™ ì„ íƒ í›„ ì¼ê´„ ë“±ë¡                                                |
| **ëŒ€ì‹œë³´ë“œ**               | `/dashboard` - ìƒí’ˆ ëª©ë¡ ë° ì„ íƒ ë“±ë¡ UI                              |
| **API ì—”ë“œí¬ì¸íŠ¸**         | `/api/scrape`                                                         |
| **ì‚¬ìš© ëª©ì **              | ì›ë³¸ ë²„ì „ (ì°¸ì¡°ìš©)                                                    |

### V1 (Current) - ì¼ê´„ ìˆ˜ì§‘ ëª¨ë“œ (í˜„ì¬ ë²„ì „)

| í•­ëª©                       | V1 (Current) íŠ¹ì§•                                             |
| -------------------------- | ------------------------------------------------------------- | --------------- |
| **ì¸ì¦**                   | API ë ˆë²¨ì—ì„œ `auth()` ì²´í¬ ì¶”ê°€                               |
| **ìŠ¤í¬ë˜í•‘ ë°©ì‹**          | 30ê°œ ìƒí’ˆì„ í•œ ë²ˆì— ì¼ê´„ ìˆ˜ì§‘                                 |
| **ì‘ë‹µ ë°©ì‹**              | ë™ê¸°ì‹ (ìˆ˜ì§‘ ì™„ë£Œ í›„ ê²°ê³¼ ë°˜í™˜, HTTP 200)                     |
| **ë°ì´í„° ì €ì¥**            | `products_v1` í…Œì´ë¸” ì‚¬ìš©                                     |
| **saveProductsToDatabase** | userId íŒŒë¼ë¯¸í„° ì¶”ê°€, tableName íŒŒë¼ë¯¸í„° ì¶”ê°€ (`'products_v1' | 'products_v2'`) |
| **ìŠ¤í¬ë˜í¼ ì˜µì…˜**          | `{ maxProducts: 30, verbose: true, forceEnglish: true }`      |
| **forceEnglish**           | `true` (ì˜ì–´ ê°•ì œ ì„¤ì •ìœ¼ë¡œ í•œê¸€ ìƒí’ˆëª… ë°©ì§€)                  |
| **ì—ëŸ¬ ì²˜ë¦¬**              | ê°„ì†Œí™”ëœ ì—ëŸ¬ ì²˜ë¦¬                                            |
| **Shopify ë“±ë¡**           | ìˆ˜ë™ ì„ íƒ í›„ ì¼ê´„ ë“±ë¡                                        |
| **ëŒ€ì‹œë³´ë“œ**               | `/dashboard` - ìƒí’ˆ ëª©ë¡ ë° ì„ íƒ ë“±ë¡ UI                      |
| **API ì—”ë“œí¬ì¸íŠ¸**         | `/api/scrape`                                                 |
| **ì‚¬ìš© ëª©ì **              | íˆìŠ¤í† ë¦¬ ìë£Œ ë³´ì¡´ (ë” ì´ìƒ ì‹ ê·œ ê°œë°œ ì—†ìŒ)                   |

### V2 (ìˆœì°¨ ì²˜ë¦¬ ëª¨ë“œ) - ì‹ ê·œ ì‹œìŠ¤í…œ

| í•­ëª©                       | V2 íŠ¹ì§•                                           |
| -------------------------- | ------------------------------------------------- |
| **ì¸ì¦**                   | API ë ˆë²¨ì—ì„œ `auth()` ì²´í¬                        |
| **ìŠ¤í¬ë˜í•‘ ë°©ì‹**          | 1ë¶„ë‹¹ 1ê°œì”© ìˆœì°¨ ìˆ˜ì§‘ (ìµœëŒ€ 1000ê°œ/ì¼)            |
| **ì‘ë‹µ ë°©ì‹**              | ë¹„ë™ê¸°ì‹ (Job ì‹œì‘ í›„ ì¦‰ì‹œ ì‘ë‹µ, HTTP 202)        |
| **ë°ì´í„° ì €ì¥**            | `products_v2` í…Œì´ë¸” ì‚¬ìš©                         |
| **saveProductsToDatabase** | userId íŒŒë¼ë¯¸í„° ìˆìŒ, tableName: `'products_v2'`  |
| **ìŠ¤í¬ë˜í¼ ì˜µì…˜**          | sequential-scraper.ts ì‚¬ìš© (ìˆœì°¨ ì²˜ë¦¬)            |
| **forceEnglish**           | ì—†ìŒ (ê¸°ë³¸ ì„¤ì •)                                  |
| **ì—ëŸ¬ ì²˜ë¦¬**              | Job ìƒíƒœ ê´€ë¦¬ ë° ì¬ì‹œë„ ë¡œì§ í¬í•¨                 |
| **Shopify ë“±ë¡**           | ìë™ ë“±ë¡ (ìˆ˜ì§‘ â†’ ì €ì¥ â†’ ë“±ë¡ ìë™í™”)             |
| **ëŒ€ì‹œë³´ë“œ**               | `/dashboard-v2` - í†µê³„ ê·¸ë˜í”„ ë° Job ì§„í–‰ ìƒí™©    |
| **API ì—”ë“œí¬ì¸íŠ¸**         | `/api/scrape-v2`                                  |
| **Job ê´€ë¦¬**               | `scraping_jobs`, `scraping_job_items` í…Œì´ë¸” ì‚¬ìš© |
| **ì§„í–‰ ìƒí™© ì¡°íšŒ**         | `/api/scrape-v2/[jobId]` ì—”ë“œí¬ì¸íŠ¸               |
| **ì‚¬ìš© ëª©ì **              | ìƒˆë¡œìš´ ì‹œìŠ¤í…œìœ¼ë¡œ ìš´ì˜ (ì§€ì†ì  ê°œë°œ)              |

---

## 3-way ë¹„êµ í…Œì´ë¸”

| í•­ëª©                                | V1 (Original)                                                                    | V1 (Current)                                                   | V2                                       |
| ----------------------------------- | -------------------------------------------------------------------------------- | -------------------------------------------------------------- | ---------------------------------------- |
| **ì¸ì¦ ë°©ì‹**                       | âŒ API ë ˆë²¨ ì—†ìŒ<br/>âœ… saveProductsToDatabase ë‚´ë¶€ë§Œ                            | âœ… API ë ˆë²¨ ì¸ì¦                                               | âœ… API ë ˆë²¨ ì¸ì¦                         |
| **ë°ì´í„° í…Œì´ë¸”**                   | `products`                                                                       | `products_v1`                                                  | `products_v2`                            |
| **saveProductsToDatabase ì‹œê·¸ë‹ˆì²˜** | `(products: ScrapedProductRaw[])`                                                | `(products, userId?, tableName?)`                              | `(products, userId, 'products_v2')`      |
| **ìŠ¤í¬ë˜í•‘ ë°©ì‹**                   | ì¼ê´„ ìˆ˜ì§‘ (30ê°œ)                                                                 | ì¼ê´„ ìˆ˜ì§‘ (30ê°œ)                                               | ìˆœì°¨ ìˆ˜ì§‘ (1ë¶„ë‹¹ 1ê°œ)                    |
| **ìŠ¤í¬ë˜í¼ ì˜µì…˜**                   | `maxProducts: 30`<br/>`timeout: 60000`<br/>`headless: true`<br/>`verbose: false` | `maxProducts: 30`<br/>`verbose: true`<br/>`forceEnglish: true` | sequential-scraper.ts ì‚¬ìš©               |
| **forceEnglish**                    | âŒ ì—†ìŒ                                                                          | âœ… `true`                                                      | âŒ ì—†ìŒ                                  |
| **ì‘ë‹µ ë°©ì‹**                       | ë™ê¸°ì‹ (HTTP 200)                                                                | ë™ê¸°ì‹ (HTTP 200)                                              | ë¹„ë™ê¸°ì‹ (HTTP 202)                      |
| **ì—ëŸ¬ ì²˜ë¦¬**                       | ìƒì„¸í•œ íƒ€ì…ë³„ ì²˜ë¦¬                                                               | ê°„ì†Œí™”ëœ ì²˜ë¦¬                                                  | Job ìƒíƒœ ê´€ë¦¬                            |
| **Job ê´€ë¦¬**                        | âŒ ì—†ìŒ                                                                          | âŒ ì—†ìŒ                                                        | âœ… `scraping_jobs`, `scraping_job_items` |
| **Shopify ë“±ë¡**                    | ìˆ˜ë™                                                                             | ìˆ˜ë™                                                           | ìë™                                     |
| **ì§„í–‰ ìƒí™© ì¡°íšŒ**                  | âŒ ì—†ìŒ                                                                          | âŒ ì—†ìŒ                                                        | âœ… `/api/scrape-v2/[jobId]`              |

---

## ì£¼ìš” ì°¨ì´ì  ìƒì„¸ ë¶„ì„

### 1. ì¸ì¦ ì°¨ì´

#### V1 (Original)

- **API ë ˆë²¨**: ì¸ì¦ ì²´í¬ ì—†ìŒ
- **saveProductsToDatabase**: í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ `auth()` í˜¸ì¶œí•˜ì—¬ userId ì¶”ì¶œ
- **ì½”ë“œ ìœ„ì¹˜**: `app/api/scrape/route.ts`ì— ì¸ì¦ ì²´í¬ ì—†ìŒ

```typescript
// V1 (Original) - ì¸ì¦ ì²´í¬ ì—†ìŒ
export async function POST(request: NextRequest) {
  // ì¸ì¦ ì²´í¬ ì—†ì´ ë°”ë¡œ ì§„í–‰
  const body = await request.json();
  // ...
  const saveResult = await saveProductsToDatabase(
    filterResult.filteredProducts,
  );
  // saveProductsToDatabase ë‚´ë¶€ì—ì„œ auth() í˜¸ì¶œ
}
```

#### V1 (Current)

- **API ë ˆë²¨**: `auth()` ì²´í¬ ì¶”ê°€
- **saveProductsToDatabase**: userId íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬
- **ì½”ë“œ ìœ„ì¹˜**: `app/api/scrape/route.ts`ì— ì¸ì¦ ì²´í¬ ì¶”ê°€

```typescript
// V1 (Current) - API ë ˆë²¨ ì¸ì¦ ì²´í¬
export async function POST(request: NextRequest) {
  const { userId } = await auth();
  if (!userId) {
    return NextResponse.json(
      { success: false, error: "ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤." },
      { status: 401 },
    );
  }
  // ...
  const saveResult = await saveProductsToDatabase(
    filterResult.filteredProducts,
    userId,
    "products_v1",
  );
}
```

#### V2

- **API ë ˆë²¨**: `auth()` ì²´í¬
- **saveProductsToDatabase**: userId íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬
- **ì½”ë“œ ìœ„ì¹˜**: `app/api/scrape-v2/route.ts`ì— ì¸ì¦ ì²´í¬

### 2. ë°ì´í„° ì €ì¥ ì°¨ì´

#### V1 (Original)

- **í…Œì´ë¸”**: `products` (ë‹¨ì¼ í…Œì´ë¸”)
- **saveProductsToDatabase**: í…Œì´ë¸”ëª… íŒŒë¼ë¯¸í„° ì—†ìŒ, í•­ìƒ `products` í…Œì´ë¸” ì‚¬ìš©
- **ì½”ë“œ**: `supabase.from("products").upsert(...)`

#### V1 (Current)

- **í…Œì´ë¸”**: `products_v1` (V1/V2 ë¶„ë¦¬)
- **saveProductsToDatabase**: tableName íŒŒë¼ë¯¸í„° ì¶”ê°€, `'products_v1'` ì „ë‹¬
- **ì½”ë“œ**: `supabase.from(tableName).upsert(...)` (tableName = 'products_v1')

#### V2

- **í…Œì´ë¸”**: `products_v2` (V1/V2 ë¶„ë¦¬)
- **saveProductsToDatabase**: tableName íŒŒë¼ë¯¸í„°ë¡œ `'products_v2'` ì „ë‹¬
- **ì½”ë“œ**: `supabase.from(tableName).upsert(...)` (tableName = 'products_v2')

### 3. ìŠ¤í¬ë˜í¼ ì˜µì…˜ ì°¨ì´

#### V1 (Original)

```typescript
const scrapeResult = await scrapeAmazonProducts(processedUrl, {
  maxProducts: 30,
  timeout: 60000,
  headless: true,
  verbose: false,
});
```

- **forceEnglish**: ì˜µì…˜ ìì²´ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŒ
- **verbose**: `false` (ìƒì„¸ ë¡œê·¸ ì—†ìŒ)

#### V1 (Current)

```typescript
const scrapeResult = await scrapeAmazonProducts(searchUrl, {
  maxProducts: 30,
  verbose: true,
  forceEnglish: true, // V1 ì „ìš©: ì˜ì–´ ê°•ì œ ì„¤ì •
});
```

- **forceEnglish**: `true` (ì˜ì–´ ê°•ì œ ì„¤ì •ìœ¼ë¡œ í•œê¸€ ìƒí’ˆëª… ë°©ì§€)
- **verbose**: `true` (ìƒì„¸ ë¡œê·¸ ì¶œë ¥)
- **timeout, headless**: ê¸°ë³¸ê°’ ì‚¬ìš©

#### V2

```typescript
// sequential-scraper.ts ì‚¬ìš©
await startSequentialScraping({
  userId,
  searchInput,
  totalTarget: totalTarget || 1000,
});
```

- **forceEnglish**: ì—†ìŒ (ê¸°ë³¸ ì„¤ì •)
- **ìˆœì°¨ ì²˜ë¦¬**: 1ë¶„ë‹¹ 1ê°œì”© ì²˜ë¦¬
- **ë³„ë„ ìŠ¤í¬ë˜í¼**: `lib/scraper/sequential-scraper.ts` ì‚¬ìš©

### 4. ì‘ë‹µ ë°©ì‹ ì°¨ì´

#### V1 (Original) & V1 (Current)

- **ì‘ë‹µ**: HTTP 200 (ë™ê¸°ì‹)
- **íŠ¹ì§•**: ìŠ¤í¬ë˜í•‘ ì™„ë£Œ í›„ ê²°ê³¼ ë°˜í™˜
- **ëŒ€ê¸° ì‹œê°„**: ìŠ¤í¬ë˜í•‘ ì™„ë£Œê¹Œì§€ ëŒ€ê¸° (30ê°œ ìˆ˜ì§‘ ì‹œ ì•½ 30ì´ˆ~1ë¶„)

```typescript
// ìŠ¤í¬ë˜í•‘ ì™„ë£Œ í›„ ê²°ê³¼ ë°˜í™˜
return NextResponse.json({
  success: true,
  data: {
    products: filterResult.filteredProducts,
    stats: { ... }
  }
}, { status: 200 });
```

#### V2

- **ì‘ë‹µ**: HTTP 202 (ë¹„ë™ê¸°ì‹)
- **íŠ¹ì§•**: Job ì‹œì‘ í›„ ì¦‰ì‹œ ì‘ë‹µ, ì§„í–‰ ìƒí™©ì€ ë³„ë„ ì¡°íšŒ
- **ëŒ€ê¸° ì‹œê°„**: ì¦‰ì‹œ ì‘ë‹µ (Jobì€ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰)

```typescript
// Job ì‹œì‘ í›„ ì¦‰ì‹œ ì‘ë‹µ
const jobId = await startSequentialScraping({ ... });
return NextResponse.json({
  success: true,
  data: { jobId, message: "ìˆœì°¨ ì²˜ë¦¬ ì‘ì—…ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤." }
}, { status: 202 });
```

### 5. ì—ëŸ¬ ì²˜ë¦¬ ì°¨ì´

#### V1 (Original)

- **ìƒì„¸í•œ ì—ëŸ¬ íƒ€ì…ë³„ ì²˜ë¦¬**:
  - Timeout ì—ëŸ¬ (HTTP 408)
  - Network ì—ëŸ¬ (HTTP 503)
  - Amazon ì ‘ê·¼ ì°¨ë‹¨ (HTTP 503)
  - ì¼ë°˜ ì—ëŸ¬ (HTTP 500)

```typescript
if (scrapeError.message.includes("timeout")) {
  return NextResponse.json({ ... }, { status: 408 });
}
if (scrapeError.message.includes("network")) {
  return NextResponse.json({ ... }, { status: 503 });
}
// ...
```

#### V1 (Current)

- **ê°„ì†Œí™”ëœ ì—ëŸ¬ ì²˜ë¦¬**:
  - ì¼ë°˜ì ì¸ ì—ëŸ¬ ë©”ì‹œì§€ ë°˜í™˜
  - HTTP 500ìœ¼ë¡œ í†µì¼

```typescript
return NextResponse.json(
  {
    success: false,
    error: error instanceof Error ? error.message : "ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",
  },
  { status: 500 },
);
```

#### V2

- **Job ìƒíƒœ ê´€ë¦¬**:
  - Job ìƒíƒœë¥¼ DBì— ì €ì¥ (`scraping_jobs.status`)
  - ì¬ì‹œë„ ë¡œì§ í¬í•¨
  - ì§„í–‰ ìƒí™© ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸

---

## êµ¬í˜„ ìƒíƒœ ì ê²€

### âœ… ì •ìƒ êµ¬í˜„ëœ ë¶€ë¶„

#### 1. V1 (Current) API (`app/api/scrape/route.ts`)

- âœ… API ë ˆë²¨ ì¸ì¦ ì²´í¬ ì¶”ê°€
- âœ… `products_v1` í…Œì´ë¸” ì‚¬ìš©
- âœ… ì¼ê´„ ìˆ˜ì§‘ ë¡œì§ ì •ìƒ êµ¬í˜„
- âœ… ì˜ì–´ ê°•ì œ ì„¤ì • ì ìš© (`forceEnglish: true`)
- âœ… ê¸ˆì§€ì–´ í•„í„°ë§ ì ìš©
- âœ… ë™ê¸°ì‹ ì‘ë‹µ (HTTP 200)
- âœ… userId íŒŒë¼ë¯¸í„° ì „ë‹¬

#### 1-1. V1 (Original) API (ì»¤ë°‹ 786690b)

- âœ… ì¼ê´„ ìˆ˜ì§‘ ë¡œì§ ì •ìƒ êµ¬í˜„
- âœ… `products` í…Œì´ë¸” ì‚¬ìš©
- âœ… ìƒì„¸í•œ ì—ëŸ¬ ì²˜ë¦¬
- âœ… ë™ê¸°ì‹ ì‘ë‹µ (HTTP 200)
- âš ï¸ API ë ˆë²¨ ì¸ì¦ ì—†ìŒ (saveProductsToDatabase ë‚´ë¶€ì—ì„œë§Œ)

#### 2. V2 API (`app/api/scrape-v2/route.ts`)

- âœ… `products_v2` í…Œì´ë¸” ì‚¬ìš© (sequential-scraper.tsì—ì„œ)
- âœ… ë¹„ë™ê¸° Job ì‹œì‘ ì •ìƒ êµ¬í˜„
- âœ… ì¦‰ì‹œ ì‘ë‹µ (HTTP 202)
- âœ… Job ID ë°˜í™˜

#### 3. V2 ìˆœì°¨ ìŠ¤í¬ë˜í¼ (`lib/scraper/sequential-scraper.ts`)

- âœ… `products_v2` í…Œì´ë¸” ì‚¬ìš©
- âœ… ìë™ Shopify ë“±ë¡ í¬í•¨
- âœ… Job ìƒíƒœ ê´€ë¦¬ (`scraping_jobs`, `scraping_job_items`)
- âœ… ì§„í–‰ ìƒí™© ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
- âœ… ì—ëŸ¬ ì²˜ë¦¬ ë° ì¬ì‹œë„ ë¡œì§

#### 4. ë°ì´í„° ì €ì¥ ìœ í‹¸ë¦¬í‹° (`lib/utils/save-products.ts`)

- âœ… í…Œì´ë¸”ëª… íŒŒë¼ë¯¸í„° ì§€ì› (`products_v1` / `products_v2`)
- âœ… V1ê³¼ V2 ëª¨ë‘ì—ì„œ ì‚¬ìš© ê°€ëŠ¥

---

## ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°

### í…Œì´ë¸” êµ¬ì¡°

#### `products` (V1 Original ì‚¬ìš©)

- V1 (Original) ë²„ì „ì—ì„œ ì‚¬ìš©í•˜ë˜ ì›ë³¸ í…Œì´ë¸”
- í˜„ì¬ëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠìŒ (ì°¸ì¡°ìš©)
- V1 (Current)ë¡œ ì „í™˜ ì‹œ `products_v1`ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜

#### `products_v1` (V1 Current íˆìŠ¤í† ë¦¬ ë³´ì¡´ìš©)

- ê¸°ì¡´ `products` í…Œì´ë¸”ì˜ ë°ì´í„°ë¥¼ ë§ˆì´ê·¸ë ˆì´ì…˜
- V1 (Current) APIì—ì„œë§Œ ì‚¬ìš©
- ë” ì´ìƒ ì‹ ê·œ ë°ì´í„° ì¶”ê°€ ì—†ìŒ (íˆìŠ¤í† ë¦¬ ë³´ì¡´)

#### `products_v2` (V2 ì‹ ê·œ ì‹œìŠ¤í…œ)

- ê¸°ì¡´ `products` í…Œì´ë¸”ì˜ ë°ì´í„°ë¥¼ ë³µì‚¬ (ì´ˆê¸° ë°ì´í„°)
- V2 APIì—ì„œ ì‚¬ìš©
- ìƒˆë¡œìš´ ìŠ¤í¬ë˜í•‘ ë°ì´í„° ì €ì¥

#### `scraping_jobs` (V2 ì „ìš©)

- ìˆœì°¨ ì²˜ë¦¬ Job ê´€ë¦¬
- ìƒíƒœ: `pending`, `running`, `paused`, `completed`, `failed`, `cancelled`

#### `scraping_job_items` (V2 ì „ìš©)

- ê° Jobì˜ ìƒí’ˆë³„ ìƒì„¸ ì •ë³´
- `product_id` â†’ `products_v2.id` ì™¸ë˜í‚¤ ì°¸ì¡°
- ìƒíƒœ: `pending`, `scraping`, `saved`, `registered`, `failed`

---

## API ì—”ë“œí¬ì¸íŠ¸ ë¹„êµ

### V1 (Original) API (ì»¤ë°‹ 786690b)

#### `POST /api/scrape`

- **ê¸°ëŠ¥**: ì¼ê´„ ìˆ˜ì§‘ (30ê°œ)
- **ì¸ì¦**: ì—†ìŒ (API ë ˆë²¨)
- **ìš”ì²­**:
  ```json
  {
    "searchInput": "í‚¤ì›Œë“œ ë˜ëŠ” Amazon URL"
  }
  ```
- **ì‘ë‹µ** (HTTP 200):
  ```json
  {
    "success": true,
    "data": {
      "products": ScrapedProductRaw[],
      "stats": {
        "totalScraped": number,
        "filteredOut": number,
        "saved": number,
        "failed": number,
        "duration": number,
        "pagesScraped": number
      }
    }
  }
  ```
- **ì €ì¥ í…Œì´ë¸”**: `products`
- **ì—ëŸ¬ ì²˜ë¦¬**: ìƒì„¸í•œ íƒ€ì…ë³„ ì²˜ë¦¬ (timeout, network, blocked ë“±)

### V1 (Current) API

#### `POST /api/scrape`

- **ê¸°ëŠ¥**: ì¼ê´„ ìˆ˜ì§‘ (30ê°œ)
- **ì¸ì¦**: API ë ˆë²¨ì—ì„œ `auth()` ì²´í¬
- **ìš”ì²­**:
  ```json
  {
    "searchInput": "í‚¤ì›Œë“œ ë˜ëŠ” Amazon URL"
  }
  ```
- **ì‘ë‹µ** (HTTP 200):
  ```json
  {
    "success": true,
    "data": {
      "products": ScrapedProductRaw[],
      "stats": {
        "totalScraped": number,
        "filteredOut": number,
        "saved": number,
        "failed": number,
        "duration": number,
        "pagesScraped": number
      }
    }
  }
  ```
- **ì €ì¥ í…Œì´ë¸”**: `products_v1`
- **ì—ëŸ¬ ì²˜ë¦¬**: ê°„ì†Œí™”ëœ ì—ëŸ¬ ì²˜ë¦¬

### V2 API

#### `POST /api/scrape-v2`

- **ê¸°ëŠ¥**: ìˆœì°¨ ì²˜ë¦¬ Job ì‹œì‘
- **ìš”ì²­**:
  ```json
  {
    "searchInput": "í‚¤ì›Œë“œ ë˜ëŠ” Amazon URL",
    "totalTarget": number (ì„ íƒì‚¬í•­, ê¸°ë³¸ê°’: 1000, ìµœëŒ€: 1000)
  }
  ```
- **ì‘ë‹µ** (HTTP 202):
  ```json
  {
    "success": true,
    "data": {
      "jobId": "string",
      "message": "ìˆœì°¨ ì²˜ë¦¬ ì‘ì—…ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤."
    }
  }
  ```
- **ì €ì¥ í…Œì´ë¸”**: `products_v2`

#### `GET /api/scrape-v2/[jobId]`

- **ê¸°ëŠ¥**: Job ì§„í–‰ ìƒí™© ì¡°íšŒ
- **ì‘ë‹µ**:
  ```json
  {
    "success": true,
    "data": {
      "jobId": "string",
      "status": "running",
      "currentCount": 50,
      "totalTarget": 1000,
      "successCount": 48,
      "failedCount": 2,
      "estimatedTimeRemaining": 950,
      "progressPercentage": 5
    }
  }
  ```

---

## ëŒ€ì‹œë³´ë“œ UI ë¹„êµ

### V1 ëŒ€ì‹œë³´ë“œ (`/dashboard`)

**ì£¼ìš” ê¸°ëŠ¥**:

- í‚¤ì›Œë“œ/URL ì…ë ¥ ë° ì¼ê´„ ìˆ˜ì§‘ ì‹œì‘
- ìˆ˜ì§‘ëœ ìƒí’ˆ ëª©ë¡ í‘œì‹œ
- ì²´í¬ë°•ìŠ¤ë¡œ ìƒí’ˆ ì„ íƒ
- ì„ íƒí•œ ìƒí’ˆ ì¼ê´„ Shopify ë“±ë¡
- ë§ˆì§„ìœ¨ ë³€ê²½ ê¸°ëŠ¥

**UI íŠ¹ì§•**:

- ìƒí’ˆ ëª©ë¡ ì¤‘ì‹¬
- ìˆ˜ë™ ì„ íƒ ë° ë“±ë¡
- ì‹¤ì‹œê°„ ê²°ê³¼ í‘œì‹œ (ë™ê¸°ì‹)

### V2 ëŒ€ì‹œë³´ë“œ (`/dashboard-v2`)

**ì£¼ìš” ê¸°ëŠ¥**:

- í†µê³„ ê·¸ë˜í”„ (ì¼ë³„ ìˆ˜ì§‘ í˜„í™©, ìƒíƒœë³„ ë¶„í¬)
- ìµœê·¼ Job í˜„í™©
- Job ì§„í–‰ ìƒí™© ì‹¤ì‹œê°„ í‘œì‹œ

**ì„œë¸Œ í˜ì´ì§€**:

- `/dashboard-v2/scrape`: ìŠ¤í¬ë˜í•‘ ì‹œì‘ í˜ì´ì§€
- `/dashboard-v2/products`: ìƒí’ˆ ëª©ë¡ ê´€ë¦¬
- `/dashboard-v2/history`: Job íˆìŠ¤í† ë¦¬

**UI íŠ¹ì§•**:

- í†µê³„ ë° ì‹œê°í™” ì¤‘ì‹¬
- ìë™í™”ëœ ì›Œí¬í”Œë¡œìš°
- ë¹„ë™ê¸° Job ì§„í–‰ ìƒí™© í‘œì‹œ

---

## í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

### V1 í…ŒìŠ¤íŠ¸ í•­ëª©

#### ê¸°ë³¸ ê¸°ëŠ¥

- [ ] `/dashboard` í˜ì´ì§€ ì ‘ì† ê°€ëŠ¥
- [ ] í‚¤ì›Œë“œ ì…ë ¥ í•„ë“œ ì •ìƒ ì‘ë™
- [ ] "ìˆ˜ì§‘ ì‹œì‘" ë²„íŠ¼ í´ë¦­ ì‹œ API í˜¸ì¶œ

#### ìŠ¤í¬ë˜í•‘ ê¸°ëŠ¥

- [ ] í‚¤ì›Œë“œ ì…ë ¥ í›„ ìŠ¤í¬ë˜í•‘ ì‹œì‘
- [ ] 30ê°œ ìƒí’ˆ ì¼ê´„ ìˆ˜ì§‘ í™•ì¸
- [ ] ìˆ˜ì§‘ ì™„ë£Œê¹Œì§€ ëŒ€ê¸° (ë™ê¸°ì‹)
- [ ] ìˆ˜ì§‘ ê²°ê³¼ ë©”ì‹œì§€ í‘œì‹œ

#### ë°ì´í„° ì €ì¥

- [ ] `products_v1` í…Œì´ë¸”ì— ë°ì´í„° ì €ì¥ í™•ì¸
- [ ] Supabaseì—ì„œ ì§ì ‘ ë°ì´í„° í™•ì¸

#### ìƒí’ˆ ëª©ë¡ ì¡°íšŒ

- [ ] í˜ì´ì§€ ë¡œë“œ ì‹œ ìƒí’ˆ ëª©ë¡ ìë™ ì¡°íšŒ
- [ ] V1 ë°ì´í„°ë§Œ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸
- [ ] ìƒí’ˆ ì •ë³´ ì •ìƒ í‘œì‹œ

#### Shopify ë“±ë¡

- [ ] ì²´í¬ë°•ìŠ¤ë¡œ ìƒí’ˆ ì„ íƒ
- [ ] "ì„ íƒ ë“±ë¡" ë²„íŠ¼ í´ë¦­
- [ ] Shopify ì¼ê´„ ë“±ë¡ ì„±ê³µ í™•ì¸
- [ ] ìƒí’ˆ ìƒíƒœê°€ `uploaded`ë¡œ ë³€ê²½ë˜ëŠ”ì§€ í™•ì¸

#### ë§ˆì§„ìœ¨ ë³€ê²½

- [ ] ë§ˆì§„ìœ¨ ì…ë ¥ í•„ë“œ ì •ìƒ ì‘ë™
- [ ] ë§ˆì§„ìœ¨ ë³€ê²½ ì‹œ íŒë§¤ê°€ ìë™ ì¬ê³„ì‚°
- [ ] DBì— ë³€ê²½ì‚¬í•­ ì €ì¥ í™•ì¸

### V2 í…ŒìŠ¤íŠ¸ í•­ëª©

#### ê¸°ë³¸ ê¸°ëŠ¥

- [ ] `/dashboard-v2` í˜ì´ì§€ ì ‘ì† ê°€ëŠ¥
- [ ] í†µê³„ ê·¸ë˜í”„ ì •ìƒ í‘œì‹œ
- [ ] ìµœê·¼ Job ëª©ë¡ í‘œì‹œ

#### ìŠ¤í¬ë˜í•‘ ê¸°ëŠ¥

- [ ] `/dashboard-v2/scrape` í˜ì´ì§€ ì ‘ì†
- [ ] í‚¤ì›Œë“œ ì…ë ¥ í›„ ìŠ¤í¬ë˜í•‘ ì‹œì‘
- [ ] Job ID ì¦‰ì‹œ ë°˜í™˜ í™•ì¸ (HTTP 202)
- [ ] ì§„í–‰ ìƒí™© ì‹¤ì‹œê°„ ì¡°íšŒ

#### ë°ì´í„° ì €ì¥

- [ ] `products_v2` í…Œì´ë¸”ì— ë°ì´í„° ì €ì¥ í™•ì¸
- [ ] `scraping_jobs` í…Œì´ë¸”ì— Job ìƒì„± í™•ì¸
- [ ] `scraping_job_items` í…Œì´ë¸”ì— ì•„ì´í…œ ìƒì„± í™•ì¸

#### ìë™ Shopify ë“±ë¡

- [ ] ìˆ˜ì§‘ â†’ ì €ì¥ â†’ ë“±ë¡ ìë™í™” í™•ì¸
- [ ] ìƒí’ˆ ìƒíƒœê°€ ìë™ìœ¼ë¡œ `uploaded`ë¡œ ë³€ê²½ë˜ëŠ”ì§€ í™•ì¸
- [ ] Shopifyì— ì‹¤ì œ ìƒí’ˆ ë“±ë¡ í™•ì¸

#### ì§„í–‰ ìƒí™© ëª¨ë‹ˆí„°ë§

- [ ] Job ì§„í–‰ ìƒí™© ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
- [ ] ì§„í–‰ë¥  í¼ì„¼íŠ¸ í‘œì‹œ
- [ ] ì˜ˆìƒ ì™„ë£Œ ì‹œê°„ í‘œì‹œ
- [ ] ì„±ê³µ/ì‹¤íŒ¨ ê°œìˆ˜ í‘œì‹œ

---

## ì•Œë ¤ì§„ ì´ìŠˆ ë° ìˆ˜ì • í•„ìš” ì‚¬í•­

### âš ï¸ ìˆ˜ì • í•„ìš” ë¶€ë¶„

#### 1. V1 ëŒ€ì‹œë³´ë“œ ìƒí’ˆ ì¡°íšŒ ë¬¸ì œ

**ë¬¸ì œì **:

- V1 ëŒ€ì‹œë³´ë“œ (`app/dashboard/page.tsx`)ê°€ `/api/products`ë¥¼ í˜¸ì¶œ
- í˜„ì¬ `/api/products`ëŠ” í•­ìƒ `products_v2`ë¥¼ ì¡°íšŒ
- V1 ëŒ€ì‹œë³´ë“œì—ì„œ V1 ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ì§€ ëª»í•¨

**ì˜í–¥**:

- V1 ëŒ€ì‹œë³´ë“œì—ì„œ ìƒí’ˆ ëª©ë¡ì´ ë¹„ì–´ ë³´ì¼ ìˆ˜ ìˆìŒ
- V1ìœ¼ë¡œ ìˆ˜ì§‘í•œ ë°ì´í„°ê°€ í‘œì‹œë˜ì§€ ì•ŠìŒ

**í•´ê²° ë°©ì•ˆ**:

1. **ì˜µì…˜ 1 (ê¶Œì¥)**: ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¡œ êµ¬ë¶„

   - `/api/products?version=v1` â†’ `products_v1` ì¡°íšŒ
   - `/api/products?version=v2` â†’ `products_v2` ì¡°íšŒ (ê¸°ë³¸ê°’)
   - V1 ëŒ€ì‹œë³´ë“œì—ì„œ `?version=v1` ì¶”ê°€

2. **ì˜µì…˜ 2**: ë³„ë„ ì—”ë“œí¬ì¸íŠ¸

   - `/api/products-v1` â†’ `products_v1` ì¡°íšŒ
   - `/api/products` â†’ `products_v2` ì¡°íšŒ (ê¸°ì¡´ ìœ ì§€)

3. **ì˜µì…˜ 3**: V1ì€ íˆìŠ¤í† ë¦¬ ì „ìš©
   - V1 ëŒ€ì‹œë³´ë“œëŠ” ì½ê¸° ì „ìš©ìœ¼ë¡œ ì œí•œ
   - V1 APIëŠ” ìŠ¤í¬ë˜í•‘ë§Œ ê°€ëŠ¥, ì¡°íšŒëŠ” V2ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸

**íŒŒì¼ ìœ„ì¹˜**:

- `app/dashboard/page.tsx` (57ë²ˆ ì¤„: `fetchProducts` í•¨ìˆ˜)
- `app/api/products/route.ts` (95-104ë²ˆ ì¤„: ì¿¼ë¦¬ ë¹Œë”)

#### 2. ìƒí’ˆ ìƒì„¸/ìˆ˜ì • API ë¬¸ì œ

**ë¬¸ì œì **:

- `app/api/products/[id]/route.ts`ê°€ í•­ìƒ `products_v2` ì¡°íšŒ
- V1 ìƒí’ˆì˜ ìƒì„¸ ì¡°íšŒ/ìˆ˜ì • ë¶ˆê°€

**í•´ê²° ë°©ì•ˆ**:

- ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ë˜ëŠ” í—¤ë”ë¡œ ë²„ì „ êµ¬ë¶„
- ë˜ëŠ” V1ì€ ì½ê¸° ì „ìš©ìœ¼ë¡œ ì œí•œ

**íŒŒì¼ ìœ„ì¹˜**:

- `app/api/products/[id]/route.ts`

#### 3. í†µê³„ API ë¬¸ì œ

**ë¬¸ì œì **:

- `app/api/dashboard/stats/route.ts`ê°€ í•­ìƒ `products_v2` ì¡°íšŒ
- V1 í†µê³„ë¥¼ ë³¼ ìˆ˜ ì—†ìŒ

**í•´ê²° ë°©ì•ˆ**:

- V2 ì „ìš©ìœ¼ë¡œ ëª…ì‹œí•˜ê±°ë‚˜
- ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¡œ V1/V2 êµ¬ë¶„

**íŒŒì¼ ìœ„ì¹˜**:

- `app/api/dashboard/stats/route.ts`

---

## ê¶Œì¥ ì‚¬í•­

### 1. V1ì€ íˆìŠ¤í† ë¦¬ ë³´ì¡´ìš©ìœ¼ë¡œ ì œí•œ

- ìƒˆë¡œìš´ ê¸°ëŠ¥ì€ V2ì—ë§Œ ì¶”ê°€
- V1 ëŒ€ì‹œë³´ë“œëŠ” ê¸°ì¡´ ë°ì´í„° ì¡°íšŒë§Œ ê°€ëŠ¥í•˜ë„ë¡ ì œí•œ ê³ ë ¤
- V1 APIëŠ” ìŠ¤í¬ë˜í•‘ ê¸°ëŠ¥ë§Œ ìœ ì§€

### 2. API ë²„ì „ êµ¬ë¶„ ëª…í™•í™”

- ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ë˜ëŠ” í—¤ë”ë¡œ ë²„ì „ êµ¬ë¶„
- API ë¬¸ì„œì— ë²„ì „ ëª…ì‹œ
- í˜¼ë™ ë°©ì§€ë¥¼ ìœ„í•œ ëª…í™•í•œ ë„¤ì´ë°

### 3. í…ŒìŠ¤íŠ¸ ìš°ì„ ìˆœìœ„

1. **V2 ìš°ì„ **: ìƒˆë¡œìš´ ì‹œìŠ¤í…œì´ë¯€ë¡œ V2 í…ŒìŠ¤íŠ¸ ìš°ì„ 
2. **V1 ê¸°ë³¸ ê¸°ëŠ¥**: íˆìŠ¤í† ë¦¬ ë³´ì¡´ìš©ì´ë¯€ë¡œ ê¸°ë³¸ ê¸°ëŠ¥ë§Œ í™•ì¸
3. **ë°ì´í„° ë¶„ë¦¬**: V1/V2 ë°ì´í„°ê°€ ì˜¬ë°”ë¥¸ í…Œì´ë¸”ì— ì €ì¥ë˜ëŠ”ì§€ í™•ì¸

---

## ê²°ë¡ 

### í˜„ì¬ ìƒíƒœ

- âœ… V1 (Current)ì™€ V2ì˜ ë°ì´í„°ë² ì´ìŠ¤ ì´ì›í™” ì™„ë£Œ
- âœ… V1 (Current) APIëŠ” `products_v1` ì‚¬ìš© ì •ìƒ
- âœ… V2 APIëŠ” `products_v2` ì‚¬ìš© ì •ìƒ
- âœ… V1 (Current) API ë ˆë²¨ ì¸ì¦ ì¶”ê°€ ì™„ë£Œ
- âš ï¸ V1 ëŒ€ì‹œë³´ë“œ ìƒí’ˆ ì¡°íšŒ ê¸°ëŠ¥ ìˆ˜ì • í•„ìš”

### í…ŒìŠ¤íŠ¸ ê°€ëŠ¥ ì—¬ë¶€

- **V1 (Original)**: ì»¤ë°‹ 786690bë¡œ ì²´í¬ì•„ì›ƒ ì‹œ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥ (ì°¸ì¡°ìš©)
- **V1 (Current)**: ê¸°ë³¸ ìŠ¤í¬ë˜í•‘ ê¸°ëŠ¥ì€ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•˜ë‚˜, ìƒí’ˆ ëª©ë¡ ì¡°íšŒëŠ” ìˆ˜ì • í›„ í…ŒìŠ¤íŠ¸ ê¶Œì¥
- **V2**: ëª¨ë“  ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥

### V1 (Original) vs V1 (Current) ì£¼ìš” ë³€ê²½ì‚¬í•­

1. **ì¸ì¦ ì¶”ê°€**: API ë ˆë²¨ì—ì„œ `auth()` ì²´í¬ ì¶”ê°€
2. **í…Œì´ë¸” ë¶„ë¦¬**: `products` â†’ `products_v1`ë¡œ ë³€ê²½
3. **saveProductsToDatabase**: userId, tableName íŒŒë¼ë¯¸í„° ì¶”ê°€
4. **forceEnglish**: `true` ì˜µì…˜ ì¶”ê°€ (í•œê¸€ ìƒí’ˆëª… ë°©ì§€)
5. **ì—ëŸ¬ ì²˜ë¦¬**: ìƒì„¸í•œ íƒ€ì…ë³„ ì²˜ë¦¬ â†’ ê°„ì†Œí™”ëœ ì²˜ë¦¬

### ë‹¤ìŒ ë‹¨ê³„

1. V1 ëŒ€ì‹œë³´ë“œ ìƒí’ˆ ì¡°íšŒ API ìˆ˜ì •
2. V1 ê¸°ë³¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
3. V2 ì „ì²´ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
4. ë°ì´í„° ë¶„ë¦¬ í™•ì¸ (V1/V2 ë°ì´í„°ê°€ ì˜¬ë°”ë¥¸ í…Œì´ë¸”ì— ì €ì¥ë˜ëŠ”ì§€)

---

**ì‘ì„±ì**: AI Assistant  
**ê²€í†  í•„ìš”**: V1 ëŒ€ì‹œë³´ë“œ ìƒí’ˆ ì¡°íšŒ API ìˆ˜ì • ì‚¬í•­ í™•ì¸
